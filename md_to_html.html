<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Markdown to HTML</title>
	<style>
		:root {
			color-scheme: light dark;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
		}

		body {
			margin: 0;
			padding: 24px;
			min-height: 100vh;
			box-sizing: border-box;
			background: Canvas;
			color: CanvasText;
		}

		h1 {
			margin: 0 0 16px;
			font-size: 1.4rem;
		}

		.container {
			display: grid;
			gap: 16px;
			max-width: 1100px;
			margin: 0 auto;
		}

		.box {
			width: 100%;
			min-height: 38vh;
			resize: vertical;
			box-sizing: border-box;
			padding: 14px;
			border: 1px solid color-mix(in srgb, CanvasText 35%, transparent);
			border-radius: 10px;
			background: color-mix(in srgb, Canvas 92%, CanvasText 8%);
			color: CanvasText;
			font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
			font-size: 0.95rem;
			line-height: 1.5;
		}

		.preview-box {
			height: 38vh;
			resize: vertical;
			box-sizing: border-box;
			padding: 14px;
			border: 1px solid color-mix(in srgb, CanvasText 35%, transparent);
			border-radius: 10px;
			background: color-mix(in srgb, Canvas 92%, CanvasText 8%);
			color: CanvasText;
			overflow-y: auto;
			overflow-x: hidden;
			white-space: normal;
			overflow-wrap: anywhere;
			word-break: break-word;
		}

		.preview-box > :first-child {
			margin-top: 0;
		}

		.preview-box > :last-child {
			margin-bottom: 0;
		}

		.box:focus {
			outline: 2px solid Highlight;
			outline-offset: 1px;
		}

		label {
			font-weight: 600;
			display: block;
			margin-bottom: 8px;
		}

		input[type='file'] {
			padding: 8px;
			border: 1px solid color-mix(in srgb, CanvasText 35%, transparent);
			border-radius: 6px;
			background: color-mix(in srgb, Canvas 92%, CanvasText 8%);
			color: CanvasText;
			cursor: pointer;
		}
	</style>
	<script defer src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
	<main class="container">
		<h1>Markdown to HTML Converter</h1>

		<section>
			<label for="markdownInput">Markdown input</label>
			<div style="margin-bottom: 12px; display: flex; flex-direction: column; gap: 8px; align-items: flex-start;">
				<input type="file" id="markdownFile" accept=".md,.markdown,text/markdown" />
				<button id="clearButton" style="padding: 8px 12px; border: 1px solid color-mix(in srgb, CanvasText 35%, transparent); border-radius: 6px; background: color-mix(in srgb, Canvas 92%, CanvasText 8%); color: CanvasText; cursor: pointer; font-weight: 500;">Clear Markdown</button>
			</div>
			<textarea id="markdownInput" class="box" placeholder="# Paste Markdown here"></textarea>
		</section>

		<section>
			<label for="htmlPreview">HTML preview</label>
			<div id="htmlPreview" class="preview-box" aria-live="polite"></div>
		</section>

		<section>
			<label for="htmlOutput">HTML output</label>
			<textarea id="htmlOutput" class="box" readonly placeholder="Converted HTML appears here"></textarea>
		</section>
	</main>

	<script>
		const markdownInput = document.getElementById('markdownInput');
		const markdownFile = document.getElementById('markdownFile');
		const clearButton = document.getElementById('clearButton');
		const htmlPreview = document.getElementById('htmlPreview');
		const htmlOutput = document.getElementById('htmlOutput');

		function convertMarkdown() {
			// Replace every single line feed with '  \n' to force <br> on every line
			let source = markdownInput.value;
			// Only replace single line feeds, not double (paragraphs)
			source = source.replace(/([^\n])\n(?!\n)/g, '$1  \n');

			if (window.marked && typeof window.marked.parse === 'function') {
				const renderedHtml = window.marked.parse(source);
				htmlOutput.value = renderedHtml;
				htmlPreview.innerHTML = renderedHtml;
			} else {
				htmlOutput.value = source;
				htmlPreview.textContent = source;
			}
		}

		markdownInput.addEventListener('input', convertMarkdown);

		// Handle markdown file upload
		markdownFile.addEventListener('change', function(event) {
			const file = event.target.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = function(e) {
					markdownInput.value = e.target.result;
					convertMarkdown();
				};
				reader.readAsText(file);
			}
		});

		// Handle clear button
		clearButton.addEventListener('click', function() {
			markdownInput.value = '';
			convertMarkdown();
		});

		convertMarkdown();
	</script>
</body>
</html>
